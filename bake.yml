image: ubuntu:18.04
tasks:
  install_rust:
    command: |
      DEBIAN_FRONTEND=noninteractive apt-get --yes update
      DEBIAN_FRONTEND=noninteractive apt-get --yes install curl
      curl https://sh.rustup.rs -sSf | sh -s -- -y

  build:
    dependencies:
      - install_rust
    files:
      - Cargo.lock
      - Cargo.toml
      - src
    location: /scratch
    command: PATH="$PATH:$HOME/.cargo/bin" cargo build

  publish:
    dependencies:
      - build
    cache: false
    args:
      AWS_ACCESS_KEY_ID: null
      AWS_DEFAULT_REGION: null
      AWS_SECRET_ACCESS_KEY: null
    location: /scratch
    command: aws s3 cp target/release/program s3://bucket/program
